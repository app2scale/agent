Script started on 2023-11-06 12:09:48+03:00 [TERM="screen" TTY="/dev/pts/2" COLUMNS="212" LINES="58"]
[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# 
[?2004l[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# 
[?2004l[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# 
[?2004l[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# python3 app2scale_teastore_s[Ks[Kclient_v4[K5.py 
[?2004l2023-11-06 12:10:12,692	WARNING deprecation.py:50 -- DeprecationWarning: `DirectStepOptimizer` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,524	INFO policy_client.py:350 -- The env you specified is not a supported (sub-)type of ExternalEnv. Attempting to convert it automatically to ExternalEnv.
2023-11-06 12:10:13,524	WARNING env.py:89 -- Env checking isn't implemented for RemoteBaseEnvs, ExternalMultiAgentEnv, ExternalEnvs or environments that are Ray actors.
2023-11-06 12:10:13,529	WARNING algorithm_config.py:2558 -- Setting `exploration_config={}` because you set `_enable_rl_module_api=True`. When RLModule API are enabled, exploration_config can not be set. If you want to implement custom exploration behaviour, please modify the `forward_exploration` method of the RLModule at hand. On configs that have a default exploration config, this must be done with `config.exploration_config={}`.
2023-11-06 12:10:13,533	WARNING deprecation.py:50 -- DeprecationWarning: `ray.rllib.models.torch.fcnet.FullyConnectedNetwork` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,533	WARNING deprecation.py:50 -- DeprecationWarning: `ray.rllib.models.torch.torch_modelv2.TorchModelV2` has been deprecated. Use `ray.rllib.core.rl_module.rl_module.RLModule` instead. This will raise an error in the future!
2023-11-06 12:10:13,540	INFO policy.py:1294 -- Policy (worker=local) running on CPU.
2023-11-06 12:10:13,541	INFO torch_policy_v2.py:113 -- Found 0 visible cuda devices.
2023-11-06 12:10:13,542	WARNING deprecation.py:50 -- DeprecationWarning: `StochasticSampling` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,542	WARNING deprecation.py:50 -- DeprecationWarning: `Exploration` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,542	WARNING deprecation.py:50 -- DeprecationWarning: `Random` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,543	WARNING deprecation.py:50 -- DeprecationWarning: `ValueNetworkMixin` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,543	WARNING deprecation.py:50 -- DeprecationWarning: `LearningRateSchedule` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,543	WARNING deprecation.py:50 -- DeprecationWarning: `EntropyCoeffSchedule` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,543	WARNING deprecation.py:50 -- DeprecationWarning: `KLCoeffMixin` has been deprecated. This will raise an error in the future!
2023-11-06 12:10:13,553	WARNING deprecation.py:50 -- DeprecationWarning: `ray.rllib.models.torch.torch_action_dist.TorchDistributionWrapper` has been deprecated. Use `ray.rllib.models.torch.torch_distributions.TorchCategorical` instead. This will raise an error in the future!
2023-11-06 12:10:13,580	INFO rollout_worker.py:1742 -- Built policy map: <PolicyMap lru-caching-capacity=100 policy-IDs=['default_policy']>
2023-11-06 12:10:13,580	INFO rollout_worker.py:1743 -- Built preprocessor map: {'default_policy': <ray.rllib.models.preprocessors.DictFlatteningPreprocessor object at 0x739a5eee9bd0>}
2023-11-06 12:10:13,580	INFO rollout_worker.py:550 -- Built filter map: defaultdict(<class 'ray.rllib.utils.filter.NoFilter'>, {'default_policy': <ray.rllib.utils.filter.NoFilter object at 0x739a5eeeab30>})
2023-11-06 12:10:13,581	INFO policy_client.py:315 -- Generating new batch of experiences.
2023-11-06 12:10:13,581	INFO rollout_worker.py:690 -- Generating sample batch of size 128
2023-11-06 12:10:13,586	INFO policy_client.py:286 -- Querying server for new policy weights.
2023-11-06 12:10:13,591	INFO policy_client.py:294 -- Updating rollout worker weights and global vars {'timestep': 4352, 'num_grad_updates_per_policy': defaultdict(<class 'int'>, {'default_policy': 1020})}.
Episode started 6dc0cfb9ea0147bb9d1d5b7350ae967f
step 1
action selected DO_NOTHING
Entering step function
applying the state...
Entering cooldown period...
cooldown period ended...
entering metric collection...
Ä°nitial running pods ['teastore-webui-5ddd7f47d8-qsrpl', 'teastore-webui-5ddd7f47d8-r4sgq']
try count for metric collection 0
collect metric running pods ['teastore-webui-5ddd7f47d8-qsrpl', 'teastore-webui-5ddd7f47d8-r4sgq']
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/urllib3/connection.py", line 169, in _new_conn
    conn = connection.create_connection(
  File "/usr/lib/python3/dist-packages/urllib3/util/connection.py", line 96, in create_connection
    raise err
  File "/usr/lib/python3/dist-packages/urllib3/util/connection.py", line 86, in create_connection
    sock.connect(sa)
  File "/usr/local/lib/python3.10/dist-packages/gevent/_socketcommon.py", line 590, in connect
    self._internal_connect(address)
  File "/usr/local/lib/python3.10/dist-packages/gevent/_socketcommon.py", line 634, in _internal_connect
    raise _SocketError(err, strerror(err))
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/urllib3/connectionpool.py", line 699, in urlopen
    httplib_response = self._make_request(
  File "/usr/lib/python3/dist-packages/urllib3/connectionpool.py", line 394, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/usr/lib/python3/dist-packages/urllib3/connection.py", line 234, in request
    super(HTTPConnection, self).request(method, url, body=body, headers=headers)
  File "/usr/lib/python3.10/http/client.py", line 1283, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "/usr/lib/python3.10/http/client.py", line 1329, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "/usr/lib/python3.10/http/client.py", line 1278, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/lib/python3.10/http/client.py", line 1038, in _send_output
    self.send(msg)
  File "/usr/lib/python3.10/http/client.py", line 976, in send
    self.connect()
  File "/usr/lib/python3/dist-packages/urllib3/connection.py", line 200, in connect
    conn = self._new_conn()
  File "/usr/lib/python3/dist-packages/urllib3/connection.py", line 181, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x739a5ee00a00>: Failed to establish a new connection: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/requests/adapters.py", line 439, in send
    resp = conn.urlopen(
  File "/usr/lib/python3/dist-packages/urllib3/connectionpool.py", line 783, in urlopen
    return self.urlopen(
  File "/usr/lib/python3/dist-packages/urllib3/connectionpool.py", line 783, in urlopen
    return self.urlopen(
  File "/usr/lib/python3/dist-packages/urllib3/connectionpool.py", line 783, in urlopen
    return self.urlopen(
  File "/usr/lib/python3/dist-packages/urllib3/connectionpool.py", line 755, in urlopen
    retries = retries.increment(
  File "/usr/lib/python3/dist-packages/urllib3/util/retry.py", line 574, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9090): Max retries exceeded with url: /api/v1/query?query=sum%28irate%28container_network_receive_packets_total%7Bpod%3D%22teastore-webui-5ddd7f47d8-qsrpl%22%2C+namespace%3D%22app2scale%22%7D%5B2m%5D%29%29 (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x739a5ee00a00>: Failed to establish a new connection: [Errno 111] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/agent/server_client/app2scale_teastore_client_v5.py", line 255, in <module>
    state, reward, info = step(action, prev_state, env)
  File "/root/agent/server_client/app2scale_teastore_client_v5.py", line 213, in step
    metrics = collect_metrics(env)  
  File "/root/agent/server_client/app2scale_teastore_client_v5.py", line 143, in collect_metrics
    temp_inc_tps = METRIC_SERVER.custom_query(query=f'sum(irate(container_network_receive_packets_total{{pod="{pod}", namespace="{NAMESPACE}"}}[2m]))')
  File "/usr/local/lib/python3.10/dist-packages/prometheus_api_client/prometheus_connect.py", line 388, in custom_query
    response = self._session.get(
  File "/usr/lib/python3/dist-packages/requests/sessions.py", line 557, in get
    return self.request('GET', url, **kwargs)
  File "/usr/lib/python3/dist-packages/requests/sessions.py", line 544, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/lib/python3/dist-packages/requests/sessions.py", line 657, in send
    r = adapter.send(request, **kwargs)
  File "/usr/lib/python3/dist-packages/requests/adapters.py", line 516, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=9090): Max retries exceeded with url: /api/v1/query?query=sum%28irate%28container_network_receive_packets_total%7Bpod%3D%22teastore-webui-5ddd7f47d8-qsrpl%22%2C+namespace%3D%22app2scale%22%7D%5B2m%5D%29%29 (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x739a5ee00a00>: Failed to establish a new connection: [Errno 111] Connection refused'))
[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# python3 app2scale_teastore_client_v5.py [Kps aux \ gre[K[K[K[K[K[K| gre[K[K[K[K[K[K [Kx | grep prom
[?2004lroot     1163055  0.0  0.0   6476  2208 pts/5    S+   12:12   0:00 grep --color=auto [01;31m[Kprom[m[K
[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# ps aux | grep prom[K[K[K[Kport-forward[Ciport-forward[1Pport-forward-port-forwardiport-forward port-forward
[?2004lroot     1163085  0.0  0.0   6612  2284 pts/5    S+   12:12   0:00 grep --color=auto -i [01;31m[Kport-forward[m[K
[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# ps aux | grep -i port-forward[C[C[C[1Pforward[1Pforward[1Pforward[1Pforward[1Pforward
[?2004lroot     1163114  0.0  0.0   6608  2416 pts/5    S+   12:12   0:00 grep --color=auto -i [01;31m[Kforward[m[K
[?2004h[root@rancher-rd-bastion server_client ([34mâŽˆ[39m|[31mrdcluster[39m:[36mapp2scale[39m)]# [?2004ltimed out waiting for input: auto-logout

Script done on 2023-11-06 12:27:37+03:00 [COMMAND_EXIT_CODE="0"]
